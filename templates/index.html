<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vampir KÃ¶ylÃ¼</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=5">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
</head>

<body>

    <div class="background-globes">
        <div class="globe globe-1"></div>
        <div class="globe globe-2"></div>
        <div class="globe globe-3"></div>
    </div>

    <div class="container">

        <!-- BÃ–LÃœM 1: GÄ°RÄ°Å EKRANI -->
        <div id="screen-home" class="screen active">
            <h1 class="game-title">VAMPÄ°R KÃ–YLÃœ</h1>

            <div class="user-input-area" style="margin-bottom: 20px; width: 100%;">
                <input type="text" id="global-username" placeholder="Ã–nce KullanÄ±cÄ± AdÄ±nÄ± Gir"
                    style="text-align: center; border-color: var(--primary-color);">
            </div>

            <div class="menu-buttons">
                <button onclick="showCreateRoom()" class="btn btn-primary">Oda Kur</button>
            </div>

            <div class="room-list-container">
                <h3>Aktif Odalar</h3>
                <div id="room-list" class="room-list">
                    <!-- Odalar buraya gelecek -->
                    <div class="empty-list">HiÃ§ oda yok...</div>
                </div>
            </div>

            <!-- Oda Kurma Formu -->
            <div id="create-room-form" class="form-section hidden">
                <h2>Oda OluÅŸtur</h2>
                <div class="input-group">
                    <label>Oda Ä°smi</label>
                    <input type="text" id="create-room-name" placeholder="Ã–rn: Kurtlar Vadisi">
                </div>
                <div class="input-group">
                    <label>Oda Åifresi (Ä°steÄŸe BaÄŸlÄ±)</label>
                    <input type="text" id="create-password" placeholder="BoÅŸ bÄ±rakÄ±rsan ÅŸifresiz olur">
                </div>
                <div class="input-group">
                    <label>Vampir SayÄ±sÄ±</label>
                    <input type="number" id="vampire-count" value="1" min="1" max="5">
                </div>
                <div class="input-group">
                    <label>KonuÅŸma SÃ¼resi (Saniye)</label>
                    <input type="number" id="speak-duration" value="60" min="10" max="300">
                </div>
                <div class="input-group">
                    <label>Oylama SÃ¼resi (Saniye)</label>
                    <input type="number" id="vote-duration" value="30" min="10" max="120">
                </div>
                <div class="input-group" style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="enable-infection" style="width: auto;">
                    <label for="enable-infection" style="margin: 0;">Enfeksiyon Modu (Vampirler Ã¶ldÃ¼rmez,
                        dÃ¶nÃ¼ÅŸtÃ¼rÃ¼r)</label>
                </div>
                <div class="form-actions">
                    <button onclick="createRoom()" class="btn btn-action">OluÅŸtur</button>
                    <button onclick="showHome()" class="btn btn-text">Geri</button>
                </div>
            </div>

            <!-- Åifre Sorma ModalÄ± (Gizli) -->
            <div id="password-modal" class="modal hidden">
                <div class="modal-content form-section">
                    <h3>Åifre Girin</h3>
                    <input type="text" id="join-password-input" placeholder="Oda ÅŸifresi">
                    <div class="form-actions">
                        <button id="confirm-join-btn" class="btn btn-primary">KatÄ±l</button>
                        <button onclick="closePasswordModal()" class="btn btn-text">Ä°ptal</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- BÃ–LÃœM 2: LOBÄ° EKRANI -->
        <div id="screen-lobby" class="screen">
            <div class="lobby-header">
                <h2 id="lobby-name-display">Lobi Ä°smi</h2>
                <p>Oda Kodu: <span id="lobby-code-display" style="color:var(--primary-color)"></span></p>
                <p>Oyuncular bekleniyor...</p>
            </div>

            <div class="players-list" id="lobby-players-list">
                <!-- Oyuncular buraya gelecek -->
            </div>

            <div id="admin-controls" class="hidden">
                <button onclick="startGame()" class="btn btn-primary pulse">Oyunu BaÅŸlat</button>
            </div>

            <!-- Sesli Sohbet Kontrolleri -->
            <div id="voice-chat-controls" class="voice-controls" style="display: flex !important;">
                <div class="voice-status">
                    <span id="mic-status">ğŸ¤ Mikrofon KapalÄ±</span>
                </div>
                <button id="ptt-btn" class="btn btn-voice" onmousedown="startTalking()" onmouseup="stopTalking()"
                    ontouchstart="startTalking()" ontouchend="stopTalking()" style="display: none;">
                    ğŸ¤ Bas ve KonuÅŸ
                </button>
                <button onclick="initVoiceChat()" class="btn btn-secondary" id="join-voice-btn"
                    style="display: block !important;">
                    ğŸ”Š Sesli Sohbete KatÄ±l
                </button>
            </div>

            <button onclick="leaveLobby()" class="btn btn-text" style="margin-top: 20px;">â† Lobiden AyrÄ±l</button>

            <!-- Lobi Sohbet Paneli -->
            <div id="lobby-chat-panel" class="chat-container" style="margin-top: 20px;">
                <h4 style="margin-bottom: 10px;">ğŸ’¬ Lobi Sohbeti</h4>
                <div id="lobby-chat-messages" class="chat-messages"></div>
                <div class="chat-input-area">
                    <input type="text" id="lobby-chat-input" placeholder="Mesaj yaz..."
                        onkeypress="if(event.key==='Enter') sendLobbyChatMessage()">
                    <button onclick="sendLobbyChatMessage()" class="btn btn-primary"
                        style="width: auto; padding: 12px 20px;">â¤</button>
                </div>
            </div>
        </div>

        <!-- BÃ–LÃœM 3: OYUN EKRANI -->
        <div id="screen-game" class="screen">
            <div class="game-header">
                <div class="role-badge" id="my-role-badge">?</div>
                <div class="phase-indicator" id="game-phase">GÃ¼ndÃ¼z</div>
                <div id="countdown-display" class="countdown hidden">
                    <span id="countdown-timer">60</span>
                </div>
            </div>

            <!-- Kaos KartÄ± Bildirimi -->
            <div id="chaos-notification" class="chaos-banner hidden">
                <span id="chaos-title">âš¡ KAOS KARTI</span>
                <p id="chaos-desc"></p>
            </div>

            <div class="game-area">
                <div class="players-grid" id="game-players-grid">
                    <!-- Oyun iÃ§i oyuncu kartlarÄ± -->
                </div>
            </div>

            <div id="action-area">
                <!-- Oylama butonlarÄ± -->
                <div id="voting-controls" class="hidden">
                    <h3>Oylama ZamanÄ±!</h3>
                    <p>ÅÃ¼phelendiÄŸin kiÅŸiyi seÃ§.</p>
                </div>

                <!-- Gece AksiyonlarÄ± Paneli -->
                <div id="night-controls" class="form-section hidden">
                    <h3 id="night-action-title">ğŸŒ™ GECE</h3>
                    <p id="night-action-desc">Hedefini seÃ§</p>
                    <div id="night-targets" class="night-targets-grid"></div>
                </div>

                <!-- Ã–lÃ¼ Oyuncu Kontrolleri -->
                <div id="dead-controls" class="form-section hidden">
                    <h3>ğŸ‘» Hayalet ModundasÄ±n</h3>
                    <p>YaÅŸayanlarÄ± rahatsÄ±z edebilirsin!</p>
                    <div class="dead-actions">
                        <button onclick="haunt('vibrate')" class="btn btn-secondary">ğŸ“³ Titret</button>
                        <button onclick="haunt('jumpscare')" class="btn btn-secondary">ğŸ‘ï¸ Korkut</button>
                    </div>
                    <div class="chaos-whisper" style="margin-top: 15px;">
                        <input type="text" id="chaos-msg-input" placeholder="KaranlÄ±k fÄ±sÄ±ltÄ± gÃ¶nder...">
                        <button onclick="sendChaosNote()" class="btn btn-secondary" style="margin-top: 10px;">ğŸŒ€
                            FÄ±sÄ±lda</button>
                    </div>
                </div>
            </div>

            <!-- Sohbet Paneli -->
            <div id="chat-panel" class="chat-container">
                <div id="chat-messages" class="chat-messages"></div>
                <div class="chat-input-area">
                    <input type="text" id="chat-input" placeholder="Mesaj yaz..."
                        onkeypress="if(event.key==='Enter') sendChatMessage()">
                    <button onclick="sendChatMessage()" class="btn btn-primary"
                        style="width: auto; padding: 12px 20px;">â¤</button>
                </div>
            </div>
        </div>

    </div>

    <!-- Stres Analizi Overlay -->
    <div id="stress-overlay" class="hidden">
        âš ï¸ NABIZ YÃœKSEK!
    </div>

    <!-- DÃ¼ello Overlay -->
    <div id="duel-overlay" class="hidden">
        <h1>âš”ï¸ DÃœELLO!</h1>
        <p>En hÄ±zlÄ± tÄ±klayan kazanÄ±r!</p>
        <button id="duel-click-btn">TIKLA!</button>
    </div>

    <!-- Notification / Toast Container -->
    <div id="toast-container"></div>

    <script src="{{ url_for('static', filename='js/game.js') }}"></script>
</body>

</html>